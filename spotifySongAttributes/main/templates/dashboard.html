<!DOCTYPE html>
<html>
<head>
    <title>Spotify Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<style>
        .genre-list {
            list-style: none;
            padding: 0;
        }

        .genre-item {
            margin: 3px 0;
        }

        .hidden {
            display: none;
        }

        .show-more-btn {
            margin: 5px 0;
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
        }
    </style>
<body>
    <h1>Welcome, {{ user['display_name'] }}</h1>

    <h4>Your top super genres:</h4>
        <ul class="genre-list" id="supergenre-list">
            {% for genre, count in user['supergenres'].items() %}
                <li class="genre-item">{{ genre }} ({{ (count | float * 100) | round(2) }}%)</li>
            {% endfor %}
        </ul>


    <h4>Your top subgenres:</h4>
    <ul class="genre-list" id="subgenre-list">
        {% for genre, count in user['subgenres'].items() %}
            {% if loop.index <= 10 %}
                <li class="genre-item">{{ genre }} ({{ (count | float * 100) | round(2) }}%)</li>
            {% else %}
                <li class="genre-item hidden extra-item">{{ genre }} ({{ (count | float * 100) | round(2) }}%)</li>
            {% endif %}
        {% endfor %}
    </ul>
    <div class="show-more-btn" id="showMoreBtn" onclick="toggleGenres()">Show More</div>

    <script>
        function toggleGenres() {
            const items = document.querySelectorAll('#subgenre-list .extra-item');
            const button = document.getElementById('showMoreBtn');

            if (button.innerText === "Show More") {

                items.forEach(item => item.classList.remove('hidden'));
                button.innerText = "Show Less";
            } else {

                items.forEach(item => item.classList.add('hidden'));
                button.innerText = "Show More";
            }
        }
    </script>




<h1> Subgenre polar area chart</h1>

    <div style="width: 700px; height: 700px;"> <canvas id="subgenreChart"></canvas> </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById('subgenreChart').getContext('2d');

            // Extract data from Flask variable
            const genreLabels = {{ user['subgenres'].items() | map(attribute=0) | list | tojson }};
            const genreValues = {{ user['subgenres'].items()| map(attribute=1) | list | tojson }};

            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: genreLabels,
                    datasets: [{
                        label: 'Genre Distribution',
                        data: genreValues,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(255, 159, 64, 0.5)',
                            'rgba(199, 199, 199, 0.5)',
                            'rgba(83, 102, 255, 0.5)',
                            'rgba(255, 99, 255, 0.5)',
                            'rgba(0, 204, 102, 0.5)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        });
    </script>

    <h1> Supergenre polar area chart</h1>
         <div style="width: 700px; height: 700px;"> <canvas id="supergenreChart"></canvas> </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById('supergenreChart').getContext('2d');

            // Extract data from Flask variable
            const genreLabels = {{ user['supergenres'].items() | map(attribute=0) | list | tojson }};
            const genreValues = {{ user['supergenres'].items() | map(attribute=1) | list | tojson }};

            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: genreLabels,
                    datasets: [{
                        label: 'Genre Distribution',
                        data: genreValues,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(255, 159, 64, 0.5)',
                            'rgba(199, 199, 199, 0.5)',
                            'rgba(83, 102, 255, 0.5)',
                            'rgba(255, 99, 255, 0.5)',
                            'rgba(0, 204, 102, 0.5)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        });
    </script>


</body>
</html>
